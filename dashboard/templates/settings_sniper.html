{% extends "base.html" %}

{% block title %}Sniper Settings - ClaudeDex{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Sniper Module Configuration</h5>
                    <button class="btn btn-primary" onclick="saveSettings()">
                        <i class="fas fa-save me-2"></i>Save Changes
                    </button>
                </div>
                <div class="card-body">
                    <form id="sniperSettingsForm">
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-uppercase text-muted mb-3">Execution Parameters</h6>

                                <div class="mb-3 form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="enabled">
                                    <label class="form-check-label" for="enabled">Enable Sniper</label>
                                    <div class="form-text">Master switch for the sniper module.</div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Trade Amount (SOL/ETH)</label>
                                    <input type="number" class="form-control" id="trade_amount" step="0.1" value="0.1">
                                    <div class="form-text">Amount to spend per snipe.</div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Max Slippage (%)</label>
                                    <input type="number" class="form-control" id="slippage" min="1" max="100" value="10">
                                </div>
                            </div>

                            <div class="col-md-6">
                                <h6 class="text-uppercase text-muted mb-3">Network & Gas</h6>

                                <div class="mb-3">
                                    <label class="form-label">Target Chain</label>
                                    <select class="form-select" id="chain">
                                        <option value="solana">Solana (Pump.fun/Raydium)</option>
                                        <option value="ethereum">Ethereum</option>
                                        <option value="bsc">BSC</option>
                                        <option value="base">Base</option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Priority Fee (Gwei/Lamports)</label>
                                    <input type="number" class="form-control" id="priority_fee" min="0" value="5000">
                                    <div class="form-text">Higher fee = faster inclusion.</div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Guide -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-book me-2"></i>Sniper Guide</h5>
                </div>
                <div class="card-body">
                    <h6>Overview</h6>
                    <p>The Sniper Module allows you to be the first to buy new token launches. It monitors the mempool (EVM) or new account creations (Solana) to detect liquidity adds.</p>

                    <h6>Configuration</h6>
                    <ul>
                        <li><strong>Trade Amount:</strong> Fixed amount of native currency to spend.</li>
                        <li><strong>Priority Fee:</strong> Critical for being first in block. On Solana, use >10000 Lamports for hype launches.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', loadSettings);

    async function loadSettings() {
        try {
            const response = await fetch('/api/sniper/settings');
            const data = await response.json();

            if (data.success) {
                const settings = data.settings;
                document.getElementById('enabled').checked = settings.enabled === true;
                document.getElementById('trade_amount').value = settings.trade_amount || 0.1;
                document.getElementById('slippage').value = settings.slippage || 10;
                document.getElementById('chain').value = settings.chain || 'solana';
                document.getElementById('priority_fee').value = settings.priority_fee || 5000;
            }
        } catch (error) {
            console.error('Error loading settings:', error);
        }
    }

    async function saveSettings() {
        const settings = {
            enabled: document.getElementById('enabled').checked,
            trade_amount: parseFloat(document.getElementById('trade_amount').value),
            slippage: parseFloat(document.getElementById('slippage').value),
            chain: document.getElementById('chain').value,
            priority_fee: parseInt(document.getElementById('priority_fee').value)
        };

        try {
            const response = await fetch('/api/sniper/settings', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(settings)
            });
            const data = await response.json();
            if(data.success) alert('Settings saved!');
            else alert('Error: ' + data.error);
        } catch (error) {
            alert('Error saving settings');
        }
    }
</script>
{% endblock %}
