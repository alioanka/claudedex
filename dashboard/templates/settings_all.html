{% extends "base.html" %}

{% block title %}Global Settings - Trading Bot{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1>Global Settings</h1>
    <p>Manage configurations for all modules from one place.</p>
    <div id="settings-form">
        <!-- Form will be dynamically generated by JavaScript -->
    </div>
    <button class="btn btn-primary mt-3" onclick="saveAllSettings()">Save All Settings</button>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        loadAllSettings();
    });

    async function loadAllSettings() {
        const response = await fetch('/api/settings/all');
        const result = await response.json();
        const form = document.getElementById('settings-form');
        form.innerHTML = '';

        for (const module in result.data) {
            const moduleSettings = result.data[module];
            let html = `<h2>${module}</h2>`;
            for (const key in moduleSettings) {
                const setting = moduleSettings[key];
                html += `
                    <div class="form-group">
                        <label for="${module}-${key}">${key}</label>
                        <input type="${setting.type}" class="form-control" id="${module}-${key}" value="${setting.value}">
                        <small class="form-text text-muted">${setting.description}</small>
                    </div>
                `;
            }
            form.innerHTML += html;
        }
    }

    async function saveAllSettings() {
        const settings = {};
        const inputs = document.querySelectorAll('#settings-form input');
        inputs.forEach(input => {
            const [module, key] = input.id.split('-');
            if (!settings[module]) {
                settings[module] = {};
            }
            settings[module][key] = input.value;
        });

        const response = await fetch('/api/settings/update', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(settings)
        });
        const result = await response.json();
        alert(result.message);
    }
</script>
{% endblock %}
