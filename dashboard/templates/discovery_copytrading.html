{% extends "base.html" %}

{% block title %}Wallet Discovery - Copy Trading{% endblock %}

{% block extra_head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    .page-container {
        padding: 20px;
    }

    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        flex-wrap: wrap;
        gap: 16px;
    }

    .page-title {
        font-size: 2rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 8px;
    }

    .page-subtitle {
        color: var(--text-secondary);
        font-size: 1rem;
    }

    .search-section {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 24px;
    }

    .search-row {
        display: flex;
        gap: 16px;
        flex-wrap: wrap;
        align-items: end;
    }

    .search-field {
        flex: 1;
        min-width: 200px;
    }

    .search-field label {
        display: block;
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--text-secondary);
        margin-bottom: 6px;
    }

    .search-field input,
    .search-field select {
        width: 100%;
        padding: 10px 14px;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        background: var(--input-bg);
        color: var(--text-primary);
        font-size: 0.9rem;
    }

    .search-field select option {
        background: var(--input-bg);
        color: var(--text-primary);
        padding: 10px;
    }

    /* Fix for dark theme dropdown options - IMPORTANT: Force background colors */
    [data-theme="dark"] .search-field select {
        background-color: #374151 !important;
        color: #f9fafb !important;
    }

    [data-theme="dark"] .search-field select option {
        background-color: #374151 !important;
        color: #f9fafb !important;
    }

    [data-theme="light"] .search-field select {
        background-color: #ffffff !important;
        color: #111827 !important;
    }

    [data-theme="light"] .search-field select option {
        background-color: #ffffff !important;
        color: #111827 !important;
    }

    /* Hot Wallets Section */
    .hot-wallets-section {
        background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(99, 102, 241, 0.1));
        border: 1px solid rgba(139, 92, 246, 0.3);
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 24px;
    }

    .hot-wallet-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 16px;
    }

    .hot-wallet-card {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 10px;
        padding: 16px;
        transition: all 0.2s;
    }

    .hot-wallet-card:hover {
        border-color: #8b5cf6;
        transform: translateY(-2px);
    }

    .hot-wallet-rank {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        font-weight: 700;
        font-size: 0.85rem;
        margin-right: 8px;
    }

    .hot-wallet-rank.gold { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; }
    .hot-wallet-rank.silver { background: linear-gradient(135deg, #9ca3af, #6b7280); color: white; }
    .hot-wallet-rank.bronze { background: linear-gradient(135deg, #f97316, #ea580c); color: white; }
    .hot-wallet-rank.default { background: #374151; color: #9ca3af; }

    .hot-wallet-header {
        display: flex;
        align-items: center;
        margin-bottom: 12px;
    }

    .hot-wallet-stats {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
    }

    .hot-wallet-stat {
        text-align: center;
    }

    .hot-wallet-stat-label {
        font-size: 0.65rem;
        color: var(--text-secondary);
        text-transform: uppercase;
        margin-bottom: 2px;
    }

    .hot-wallet-stat-value {
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--text-primary);
    }

    .refresh-info {
        font-size: 0.75rem;
        color: var(--text-secondary);
        margin-left: auto;
    }

    .btn {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 10px 20px;
        border-radius: 8px;
        font-size: 0.9rem;
        font-weight: 500;
        cursor: pointer;
        border: none;
        transition: all 0.2s;
    }

    .btn-primary {
        background: linear-gradient(135deg, #8b5cf6, #6366f1);
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
    }

    .btn-secondary {
        background: #6b7280;
        color: white;
    }

    .btn-success {
        background: #10b981;
        color: white;
    }

    .btn-success:hover {
        background: #059669;
    }

    .section-card {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 24px;
    }

    .section-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .wallet-table {
        width: 100%;
        border-collapse: collapse;
    }

    .wallet-table th {
        background: var(--metric-bg);
        padding: 14px 12px;
        text-align: left;
        font-weight: 600;
        color: var(--text-secondary);
        font-size: 0.75rem;
        text-transform: uppercase;
        white-space: nowrap;
    }

    .wallet-table td {
        padding: 14px 12px;
        border-bottom: 1px solid var(--border-color);
        white-space: nowrap;
    }

    .wallet-table tr:hover {
        background: var(--metric-bg);
    }

    .table-responsive {
        overflow-x: auto;
    }

    .wallet-address {
        font-family: monospace;
        font-size: 0.85rem;
        color: #8b5cf6;
    }

    .score-badge {
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .score-excellent {
        background: rgba(16, 185, 129, 0.2);
        color: #10b981;
    }

    .score-good {
        background: rgba(59, 130, 246, 0.2);
        color: #3b82f6;
    }

    .score-average {
        background: rgba(245, 158, 11, 0.2);
        color: #f59e0b;
    }

    .score-poor {
        background: rgba(239, 68, 68, 0.2);
        color: #ef4444;
    }

    .positive { color: #10b981; }
    .negative { color: #ef4444; }

    .loading-state {
        text-align: center;
        padding: 60px 20px;
        color: var(--text-secondary);
    }

    .loading-spinner {
        border: 3px solid var(--border-color);
        border-top: 3px solid #8b5cf6;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 16px;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .stats-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
    }

    .stat-card {
        background: var(--metric-bg);
        border-radius: 10px;
        padding: 16px;
        text-align: center;
    }

    .stat-label {
        font-size: 0.75rem;
        color: var(--text-secondary);
        text-transform: uppercase;
        margin-bottom: 6px;
    }

    .stat-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-primary);
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: var(--text-secondary);
    }

    .empty-state i {
        font-size: 3rem;
        margin-bottom: 16px;
        opacity: 0.5;
    }

    [data-theme="dark"] {
        --card-bg: #1f2937;
        --border-color: #374151;
        --text-primary: #f9fafb;
        --text-secondary: #9ca3af;
        --metric-bg: #111827;
        --input-bg: #374151;
    }

    [data-theme="light"] {
        --card-bg: #ffffff;
        --border-color: #e5e7eb;
        --text-primary: #111827;
        --text-secondary: #6b7280;
        --metric-bg: #f3f4f6;
        --input-bg: #ffffff;
    }
</style>
{% endblock %}

{% block content %}
<div class="page-container">
    <!-- Header -->
    <div class="page-header">
        <div>
            <h1 class="page-title">
                <i class="fas fa-search-dollar"></i>
                Best Wallet Discovery
            </h1>
            <p class="page-subtitle">Find and analyze top-performing Solana wallets to copy</p>
        </div>
    </div>

    <!-- Hot Wallets Section - Auto-discovered profitable wallets -->
    <div class="hot-wallets-section">
        <div class="section-title" style="margin-bottom: 16px;">
            <i class="fas fa-fire" style="color: #f59e0b;"></i>
            Hot Wallets This Week
            <span class="refresh-info" id="hotWalletsRefreshInfo">Auto-refreshes every 5 min</span>
        </div>
        <div id="hotWalletsContainer">
            <div class="loading-state" style="padding: 30px;">
                <div class="loading-spinner"></div>
                <p>Discovering hot wallets...</p>
            </div>
        </div>
    </div>

    <!-- Search Section -->
    <div class="search-section">
        <div class="search-row">
            <div class="search-field">
                <label>Search Type</label>
                <select id="searchType">
                    <option value="top_traders">Top Traders (Last 30 Days)</option>
                    <option value="top_traders_7d">Top Traders (Last 7 Days)</option>
                    <option value="top_volume">Top Volume Traders</option>
                    <option value="meme_hunters">Meme Coin Hunters</option>
                    <option value="dex_whales">DEX Whales</option>
                    <option value="token_traders">Top Traders for Token</option>
                    <option value="analyze_wallet">Analyze Specific Wallet</option>
                </select>
            </div>
            <div class="search-field" id="tokenAddressField" style="display:none;">
                <label>Token Address</label>
                <input type="text" id="tokenAddress" placeholder="So11111111111111111111111111111111111111112">
            </div>
            <div class="search-field" id="walletAddressField" style="display:none;">
                <label>Wallet Address</label>
                <input type="text" id="walletAddress" placeholder="4yrHms7ekgTBgJg2...">
            </div>
            <div class="search-field">
                <label>Min Win Rate (%)</label>
                <input type="number" id="minWinRate" value="40" min="0" max="100">
            </div>
            <div class="search-field">
                <label>Min Trades</label>
                <input type="number" id="minTrades" value="5" min="1">
            </div>
        </div>
        <!-- Additional Filters Row -->
        <div class="search-row" style="margin-top: 12px;">
            <div class="search-field">
                <label>Min PnL ($)</label>
                <input type="number" id="minPnl" value="0" step="100">
            </div>
            <div class="search-field">
                <label>Max Results</label>
                <select id="maxResults">
                    <option value="10">10 wallets</option>
                    <option value="25" selected>25 wallets</option>
                    <option value="50">50 wallets</option>
                    <option value="100">100 wallets</option>
                </select>
            </div>
            <div class="search-field">
                <label>Sort By</label>
                <select id="sortBy">
                    <option value="score">Performance Score</option>
                    <option value="pnl">Total PnL</option>
                    <option value="winrate">Win Rate</option>
                    <option value="trades">Trade Count</option>
                </select>
            </div>
            <button class="btn btn-primary" onclick="searchWallets()">
                <i class="fas fa-search"></i> Search
            </button>
            <button class="btn btn-secondary" onclick="resetFilters()">
                <i class="fas fa-undo"></i> Reset
            </button>
        </div>
    </div>

    <!-- Results Stats -->
    <div class="stats-row" id="resultsStats" style="display:none;">
        <div class="stat-card">
            <div class="stat-label">Wallets Found</div>
            <div class="stat-value" id="stat-wallets">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Avg Win Rate</div>
            <div class="stat-value" id="stat-winrate">0%</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Avg PnL</div>
            <div class="stat-value" id="stat-pnl">$0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Top Score</div>
            <div class="stat-value" id="stat-topscore">0</div>
        </div>
    </div>

    <!-- Results Table -->
    <div class="section-card">
        <div class="section-title">
            <i class="fas fa-trophy"></i>
            Discovery Results
        </div>
        <div id="resultsContainer">
            <div class="empty-state">
                <i class="fas fa-search"></i>
                <h3>Search for Top Wallets</h3>
                <p>Enter your search criteria above and click Search to find profitable wallets to copy.</p>
            </div>
        </div>
    </div>

    <!-- Info Section -->
    <div class="section-card">
        <div class="section-title">
            <i class="fas fa-info-circle"></i>
            Scoring Methodology
        </div>
        <div class="row">
            <div class="col-md-6">
                <h6>Performance Score (0-100)</h6>
                <p>Calculated based on:</p>
                <ul>
                    <li><strong>Win Rate (40%):</strong> Percentage of profitable trades</li>
                    <li><strong>Total PnL (30%):</strong> Overall profit/loss in USD</li>
                    <li><strong>Trade Frequency (15%):</strong> Activity level (trades per week)</li>
                    <li><strong>Consistency (15%):</strong> Standard deviation of returns</li>
                </ul>
            </div>
            <div class="col-md-6">
                <h6>Score Ratings</h6>
                <div class="table-responsive">
                    <table class="table table-sm">
                        <tbody>
                            <tr><td><span class="score-badge score-excellent">80-100</span></td><td>Excellent - Top performer</td></tr>
                            <tr><td><span class="score-badge score-good">60-79</span></td><td>Good - Above average</td></tr>
                            <tr><td><span class="score-badge score-average">40-59</span></td><td>Average - Mixed results</td></tr>
                            <tr><td><span class="score-badge score-poor">0-39</span></td><td>Poor - Below average</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Toggle fields based on search type
    document.getElementById('searchType').addEventListener('change', function() {
        const type = this.value;
        document.getElementById('tokenAddressField').style.display = type === 'token_traders' ? 'block' : 'none';
        document.getElementById('walletAddressField').style.display = type === 'analyze_wallet' ? 'block' : 'none';
    });

    async function searchWallets() {
        const searchType = document.getElementById('searchType').value;
        const minWinRate = parseFloat(document.getElementById('minWinRate').value);
        const minTrades = parseInt(document.getElementById('minTrades').value);
        const minPnl = parseFloat(document.getElementById('minPnl').value) || 0;
        const maxResults = parseInt(document.getElementById('maxResults').value);
        const sortBy = document.getElementById('sortBy').value;
        const tokenAddress = document.getElementById('tokenAddress').value;
        const walletAddress = document.getElementById('walletAddress').value;

        // Show loading state
        document.getElementById('resultsContainer').innerHTML = `
            <div class="loading-state">
                <div class="loading-spinner"></div>
                <p>Searching for top wallets...</p>
                <small class="text-muted">This may take a moment...</small>
            </div>
        `;
        document.getElementById('resultsStats').style.display = 'none';

        try {
            const params = new URLSearchParams({
                type: searchType,
                min_win_rate: minWinRate,
                min_trades: minTrades,
                min_pnl: minPnl,
                max_results: maxResults,
                sort_by: sortBy,
                token_address: tokenAddress,
                wallet_address: walletAddress
            });

            const response = await fetch(`/api/copytrading/discover?${params}`);
            const data = await response.json();

            if (data.success && data.wallets && data.wallets.length > 0) {
                // Sort results based on selection
                let sorted = [...data.wallets];
                switch(sortBy) {
                    case 'pnl': sorted.sort((a, b) => b.total_pnl - a.total_pnl); break;
                    case 'winrate': sorted.sort((a, b) => b.win_rate - a.win_rate); break;
                    case 'trades': sorted.sort((a, b) => b.total_trades - a.total_trades); break;
                    default: sorted.sort((a, b) => b.score - a.score);
                }
                displayResults(sorted.slice(0, maxResults));
            } else if (data.error) {
                showError(data.error);
            } else {
                showNoResults();
            }
        } catch (error) {
            console.error('Search error:', error);
            showError('Failed to search wallets. Please try again.');
        }
    }

    function resetFilters() {
        document.getElementById('searchType').value = 'top_traders';
        document.getElementById('minWinRate').value = '40';
        document.getElementById('minTrades').value = '5';
        document.getElementById('minPnl').value = '0';
        document.getElementById('maxResults').value = '25';
        document.getElementById('sortBy').value = 'score';
        document.getElementById('tokenAddress').value = '';
        document.getElementById('walletAddress').value = '';
        document.getElementById('tokenAddressField').style.display = 'none';
        document.getElementById('walletAddressField').style.display = 'none';
    }

    function displayResults(wallets) {
        // Update stats
        document.getElementById('resultsStats').style.display = 'grid';
        document.getElementById('stat-wallets').textContent = wallets.length;

        const avgWinRate = wallets.reduce((a, w) => a + w.win_rate, 0) / wallets.length;
        document.getElementById('stat-winrate').textContent = avgWinRate.toFixed(1) + '%';

        const avgPnl = wallets.reduce((a, w) => a + w.total_pnl, 0) / wallets.length;
        document.getElementById('stat-pnl').textContent = '$' + avgPnl.toFixed(2);

        const topScore = Math.max(...wallets.map(w => w.score));
        document.getElementById('stat-topscore').textContent = topScore.toFixed(0);

        // Build table
        let html = `
            <div class="table-responsive">
                <table class="wallet-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Wallet Address</th>
                            <th>Score</th>
                            <th>Win Rate</th>
                            <th>Total Trades</th>
                            <th>Total PnL</th>
                            <th>Avg Trade</th>
                            <th>Last Active</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
        `;

        wallets.forEach((wallet, index) => {
            const scoreClass = getScoreClass(wallet.score);
            const pnlClass = wallet.total_pnl >= 0 ? 'positive' : 'negative';

            html += `
                <tr>
                    <td>#${index + 1}</td>
                    <td>
                        <span class="wallet-address" title="${wallet.address}">
                            ${wallet.address.substring(0, 8)}...${wallet.address.slice(-6)}
                        </span>
                        <a href="https://solscan.io/account/${wallet.address}" target="_blank" style="margin-left:8px;">
                            <i class="fas fa-external-link-alt" style="font-size:0.75rem;"></i>
                        </a>
                    </td>
                    <td><span class="score-badge ${scoreClass}">${wallet.score.toFixed(0)}</span></td>
                    <td>${wallet.win_rate.toFixed(1)}%</td>
                    <td>${wallet.total_trades}</td>
                    <td class="${pnlClass}">$${wallet.total_pnl.toFixed(2)}</td>
                    <td>$${wallet.avg_trade_size.toFixed(2)}</td>
                    <td>${wallet.last_active}</td>
                    <td>
                        <button class="btn btn-success btn-sm" onclick="addToTracking('${wallet.address}')">
                            <i class="fas fa-plus"></i> Track
                        </button>
                    </td>
                </tr>
            `;
        });

        html += `
                    </tbody>
                </table>
            </div>
        `;

        document.getElementById('resultsContainer').innerHTML = html;
    }

    function getScoreClass(score) {
        if (score >= 80) return 'score-excellent';
        if (score >= 60) return 'score-good';
        if (score >= 40) return 'score-average';
        return 'score-poor';
    }

    function showNoResults() {
        document.getElementById('resultsStats').style.display = 'none';
        document.getElementById('resultsContainer').innerHTML = `
            <div class="empty-state">
                <i class="fas fa-search"></i>
                <h3>No Wallets Found</h3>
                <p>Try adjusting your search criteria (lower win rate or fewer minimum trades).</p>
            </div>
        `;
    }

    function showError(message) {
        document.getElementById('resultsStats').style.display = 'none';
        document.getElementById('resultsContainer').innerHTML = `
            <div class="empty-state">
                <i class="fas fa-exclamation-triangle" style="color: #ef4444;"></i>
                <h3>Error</h3>
                <p>${message}</p>
            </div>
        `;
    }

    async function addToTracking(address) {
        try {
            // First get current settings
            const getResponse = await fetch('/api/copytrading/settings');
            const getData = await getResponse.json();

            if (!getData.success) {
                alert('Failed to load current settings');
                return;
            }

            const currentWallets = getData.settings.target_wallets || [];

            // Check if already tracked
            if (currentWallets.includes(address)) {
                alert('This wallet is already being tracked!');
                return;
            }

            // Add new wallet
            currentWallets.push(address);

            // Save updated settings
            const saveResponse = await fetch('/api/copytrading/settings', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    ...getData.settings,
                    target_wallets: currentWallets
                })
            });

            const saveData = await saveResponse.json();

            if (saveData.success) {
                alert('Wallet added to tracking list!');
                // Refresh hot wallets to update tracking status
                loadHotWallets();
            } else {
                alert('Failed to add wallet: ' + saveData.error);
            }
        } catch (error) {
            console.error('Error adding wallet:', error);
            alert('Failed to add wallet to tracking');
        }
    }

    // ===== Hot Wallets Auto-Discovery =====
    let trackedWallets = [];

    async function loadTrackedWallets() {
        try {
            const response = await fetch('/api/copytrading/settings');
            const data = await response.json();
            if (data.success && data.settings.target_wallets) {
                trackedWallets = data.settings.target_wallets;
            }
        } catch (error) {
            console.error('Error loading tracked wallets:', error);
        }
    }

    async function loadHotWallets() {
        const container = document.getElementById('hotWalletsContainer');

        try {
            // First load tracked wallets to check if already tracking
            await loadTrackedWallets();

            // Search for top traders in last 7 days with good win rate
            const params = new URLSearchParams({
                type: 'top_traders_7d',
                min_win_rate: 50,
                min_trades: 3,
                min_pnl: 100,
                max_results: 10,
                sort_by: 'score'
            });

            const response = await fetch(`/api/copytrading/discover?${params}`);
            const data = await response.json();

            if (data.success && data.wallets && data.wallets.length > 0) {
                displayHotWallets(data.wallets.slice(0, 10));
                document.getElementById('hotWalletsRefreshInfo').textContent =
                    'Updated: ' + new Date().toLocaleTimeString();
            } else {
                container.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: var(--text-secondary);">
                        <i class="fas fa-fire-alt" style="font-size: 2rem; margin-bottom: 12px; opacity: 0.5;"></i>
                        <p>No hot wallets found this week. Try searching with custom filters below.</p>
                    </div>
                `;
            }
        } catch (error) {
            console.error('Error loading hot wallets:', error);
            container.innerHTML = `
                <div style="text-align: center; padding: 30px; color: var(--text-secondary);">
                    <i class="fas fa-exclamation-triangle" style="color: #f59e0b; font-size: 2rem; margin-bottom: 12px;"></i>
                    <p>Failed to load hot wallets. Will retry shortly...</p>
                </div>
            `;
        }
    }

    function displayHotWallets(wallets) {
        const container = document.getElementById('hotWalletsContainer');

        let html = '<div class="hot-wallet-grid">';

        wallets.forEach((wallet, index) => {
            const rankClass = index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? 'bronze' : 'default';
            const pnlClass = wallet.total_pnl >= 0 ? 'positive' : 'negative';
            const isTracked = trackedWallets.includes(wallet.address);

            html += `
                <div class="hot-wallet-card">
                    <div class="hot-wallet-header">
                        <span class="hot-wallet-rank ${rankClass}">${index + 1}</span>
                        <span class="wallet-address" title="${wallet.address}" style="flex: 1;">
                            ${wallet.address.substring(0, 6)}...${wallet.address.slice(-4)}
                        </span>
                        <a href="https://solscan.io/account/${wallet.address}" target="_blank" style="color: var(--text-secondary); margin-right: 8px;">
                            <i class="fas fa-external-link-alt"></i>
                        </a>
                        ${isTracked ?
                            '<span style="color: #10b981; font-size: 0.75rem;"><i class="fas fa-check-circle"></i> Tracked</span>' :
                            `<button class="btn btn-success" style="padding: 4px 8px; font-size: 0.7rem;" onclick="addToTracking('${wallet.address}')">
                                <i class="fas fa-plus"></i> Track
                            </button>`
                        }
                    </div>
                    <div class="hot-wallet-stats">
                        <div class="hot-wallet-stat">
                            <div class="hot-wallet-stat-label">Win Rate</div>
                            <div class="hot-wallet-stat-value">${wallet.win_rate.toFixed(0)}%</div>
                        </div>
                        <div class="hot-wallet-stat">
                            <div class="hot-wallet-stat-label">Trades</div>
                            <div class="hot-wallet-stat-value">${wallet.total_trades}</div>
                        </div>
                        <div class="hot-wallet-stat">
                            <div class="hot-wallet-stat-label">PnL</div>
                            <div class="hot-wallet-stat-value ${pnlClass}">$${wallet.total_pnl.toFixed(0)}</div>
                        </div>
                    </div>
                </div>
            `;
        });

        html += '</div>';
        container.innerHTML = html;
    }

    // Load hot wallets on page load
    loadHotWallets();

    // Refresh hot wallets every 5 minutes
    setInterval(loadHotWallets, 5 * 60 * 1000);
</script>
{% endblock %}
