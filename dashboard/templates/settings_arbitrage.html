{% extends "base.html" %}

{% block title %}Arbitrage Settings - ClaudeDex{% endblock %}

{% block extra_head %}
<style>
    .nav-pills .nav-link {
        color: var(--text-secondary);
        border-radius: 8px;
        padding: 10px 20px;
        margin-right: 8px;
    }
    .nav-pills .nav-link.active {
        background: linear-gradient(135deg, #3b82f6, #8b5cf6);
        color: white;
    }
    .nav-pills .nav-link:hover:not(.active) {
        background: var(--metric-bg);
    }
    .settings-section {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 24px;
    }
    .settings-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .chain-card {
        background: var(--metric-bg);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 16px;
    }
    .chain-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 16px;
    }
    .chain-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
    }
    .chain-icon.ethereum { background: linear-gradient(135deg, #627eea, #3c3c3d); color: white; }
    .chain-icon.solana { background: linear-gradient(135deg, #9945FF, #14F195); color: white; }
    .chain-icon.triangular { background: linear-gradient(135deg, #f59e0b, #ef4444); color: white; }
    .feature-badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
    }
    .badge-new { background: rgba(16, 185, 129, 0.2); color: #10b981; }
    .badge-live { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
    .badge-beta { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
    .code-block {
        background: #1e293b;
        color: #e2e8f0;
        padding: 16px;
        border-radius: 8px;
        font-family: 'Fira Code', monospace;
        font-size: 0.85rem;
        overflow-x: auto;
    }
    .token-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 8px;
    }
    .token-tag {
        background: var(--metric-bg);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        padding: 6px 10px;
        font-size: 0.8rem;
        text-align: center;
    }
    .step-card {
        background: var(--metric-bg);
        border-left: 3px solid #3b82f6;
        padding: 16px;
        margin-bottom: 12px;
        border-radius: 0 8px 8px 0;
    }
    .step-number {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 28px;
        height: 28px;
        background: #3b82f6;
        color: white;
        border-radius: 50%;
        font-weight: 600;
        margin-right: 12px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid" style="padding: 20px;">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="mb-1"><i class="fas fa-exchange-alt me-2"></i>Arbitrage Module Settings</h2>
            <p class="text-muted mb-0">Multi-chain arbitrage with Ethereum, Solana, and Triangular strategies</p>
        </div>
        <button class="btn btn-primary" onclick="saveSettings()">
            <i class="fas fa-save me-2"></i>Save All Settings
        </button>
    </div>

    <!-- Navigation Tabs -->
    <ul class="nav nav-pills mb-4" id="settingsTabs">
        <li class="nav-item">
            <a class="nav-link active" data-bs-toggle="pill" href="#settings-general">
                <i class="fas fa-cog me-2"></i>General
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="pill" href="#settings-chains">
                <i class="fas fa-link me-2"></i>Chains
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="pill" href="#settings-advanced">
                <i class="fas fa-sliders-h me-2"></i>Advanced
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="pill" href="#guide">
                <i class="fas fa-book me-2"></i>Guide
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="pill" href="#setup">
                <i class="fas fa-wrench me-2"></i>Setup
            </a>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content">
        <!-- General Settings Tab -->
        <div class="tab-pane fade show active" id="settings-general">
            <div class="row">
                <div class="col-md-6">
                    <div class="settings-section">
                        <div class="settings-title">
                            <i class="fas fa-power-off text-primary"></i>
                            Module Control
                        </div>

                        <div class="mb-3 form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="enabled">
                            <label class="form-check-label" for="enabled"><strong>Enable Arbitrage Module</strong></label>
                            <div class="form-text">Master switch for all arbitrage engines.</div>
                        </div>

                        <div class="mb-3 form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="dry_run" checked>
                            <label class="form-check-label" for="dry_run"><strong>DRY RUN Mode</strong></label>
                            <div class="form-text">Simulate trades without real execution. <span class="text-danger">Disable for LIVE trading.</span></div>
                        </div>

                        <div class="alert alert-warning mb-0">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Important:</strong> Always test with DRY RUN enabled before going live.
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="settings-section">
                        <div class="settings-title">
                            <i class="fas fa-chart-line text-success"></i>
                            Profit Thresholds
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Base Profit Threshold (%)</label>
                            <input type="number" class="form-control" id="min_profit_spread" min="0.1" step="0.1" value="0.5">
                            <div class="form-text">Minimum profit required before gas costs. Ethereum: 0.5%+, Solana: 0.3%+</div>
                        </div>

                        <div class="mb-3 form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="gas_aware_threshold" checked>
                            <label class="form-check-label" for="gas_aware_threshold"><strong>Dynamic Gas-Aware Thresholds</strong></label>
                            <div class="form-text">Automatically adjust thresholds based on current gas prices.</div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Gas Buffer Multiplier</label>
                            <input type="number" class="form-control" id="gas_buffer" min="1" max="3" step="0.1" value="1.5">
                            <div class="form-text">Multiply gas cost estimate by this factor for safety margin.</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="settings-section">
                        <div class="settings-title">
                            <i class="fas fa-dollar-sign text-warning"></i>
                            Trade Sizing
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Ethereum Trade Amount (ETH)</label>
                            <input type="number" class="form-control" id="eth_trade_amount" min="0.1" step="0.1" value="1">
                            <div class="form-text">Amount per trade on Ethereum. Uses flash loans if enabled.</div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Solana Trade Amount (SOL)</label>
                            <input type="number" class="form-control" id="sol_trade_amount" min="0.1" step="0.1" value="1">
                            <div class="form-text">Amount per trade on Solana.</div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Max Daily Trades per Pair</label>
                            <input type="number" class="form-control" id="max_daily_trades" min="1" max="100" value="5">
                            <div class="form-text">Limit executions per DEX pair per day to avoid overtrading.</div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="settings-section">
                        <div class="settings-title">
                            <i class="fas fa-clock text-info"></i>
                            Rate Limiting
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Scan Interval (seconds)</label>
                            <input type="number" class="form-control" id="scan_interval" min="1" max="60" value="2">
                            <div class="form-text">Time between price checks. Lower = faster detection but more RPC calls.</div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Opportunity Cooldown (minutes)</label>
                            <input type="number" class="form-control" id="opportunity_cooldown" min="1" max="120" value="30">
                            <div class="form-text">Wait time before re-executing same opportunity.</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chains Settings Tab -->
        <div class="tab-pane fade" id="settings-chains">
            <!-- Ethereum Chain -->
            <div class="chain-card">
                <div class="chain-header">
                    <div class="chain-icon ethereum"><i class="fab fa-ethereum"></i></div>
                    <div>
                        <h5 class="mb-0">Ethereum <span class="feature-badge badge-live">Live</span></h5>
                        <small class="text-muted">Uniswap, SushiSwap, Curve, Balancer</small>
                    </div>
                    <div class="form-check form-switch ms-auto">
                        <input class="form-check-input" type="checkbox" id="ethereum_enabled" checked>
                        <label class="form-check-label" for="ethereum_enabled">Enabled</label>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <h6 class="mb-3">DEX Selection</h6>
                        <div class="mb-2 form-check">
                            <input class="form-check-input" type="checkbox" id="dex_uniswap_v2" checked>
                            <label class="form-check-label">Uniswap V2</label>
                        </div>
                        <div class="mb-2 form-check">
                            <input class="form-check-input" type="checkbox" id="dex_sushiswap" checked>
                            <label class="form-check-label">SushiSwap</label>
                        </div>
                        <div class="mb-2 form-check">
                            <input class="form-check-input" type="checkbox" id="dex_uniswap_v3" checked>
                            <label class="form-check-label">Uniswap V3</label>
                        </div>
                        <div class="mb-2 form-check">
                            <input class="form-check-input" type="checkbox" id="dex_curve">
                            <label class="form-check-label">Curve Finance <span class="feature-badge badge-new">New</span></label>
                        </div>
                        <div class="mb-2 form-check">
                            <input class="form-check-input" type="checkbox" id="dex_balancer">
                            <label class="form-check-label">Balancer <span class="feature-badge badge-new">New</span></label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6 class="mb-3">Token Pairs (20 pairs)</h6>
                        <div class="token-grid">
                            <div class="token-tag">WETH/USDC</div>
                            <div class="token-tag">WETH/USDT</div>
                            <div class="token-tag">WETH/DAI</div>
                            <div class="token-tag">WBTC/WETH</div>
                            <div class="token-tag">LINK/WETH</div>
                            <div class="token-tag">UNI/WETH</div>
                            <div class="token-tag">AAVE/WETH</div>
                            <div class="token-tag">MATIC/WETH</div>
                            <div class="token-tag">CRV/WETH</div>
                            <div class="token-tag">LDO/WETH</div>
                            <div class="token-tag">MKR/WETH</div>
                            <div class="token-tag">SNX/WETH</div>
                            <div class="token-tag">COMP/WETH</div>
                            <div class="token-tag">BAL/WETH</div>
                            <div class="token-tag">YFI/WETH</div>
                            <div class="token-tag">GRT/WETH</div>
                            <div class="token-tag">ENS/WETH</div>
                            <div class="token-tag">SHIB/WETH</div>
                            <div class="token-tag">PEPE/WETH</div>
                            <div class="token-tag">SUSHI/WETH</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Solana Chain -->
            <div class="chain-card">
                <div class="chain-header">
                    <div class="chain-icon solana"><i class="fas fa-sun"></i></div>
                    <div>
                        <h5 class="mb-0">Solana <span class="feature-badge badge-new">New</span></h5>
                        <small class="text-muted">Jupiter, Raydium, Orca with Jito MEV protection</small>
                    </div>
                    <div class="form-check form-switch ms-auto">
                        <input class="form-check-input" type="checkbox" id="solana_enabled">
                        <label class="form-check-label" for="solana_enabled">Enabled</label>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <h6 class="mb-3">DEX Integration</h6>
                        <div class="mb-2 form-check">
                            <input class="form-check-input" type="checkbox" id="dex_jupiter" checked>
                            <label class="form-check-label">Jupiter Aggregator (All DEXs)</label>
                        </div>
                        <div class="mb-2 form-check">
                            <input class="form-check-input" type="checkbox" id="dex_raydium" checked>
                            <label class="form-check-label">Raydium (Direct)</label>
                        </div>
                        <div class="mb-2 form-check">
                            <input class="form-check-input" type="checkbox" id="dex_orca">
                            <label class="form-check-label">Orca Whirlpools</label>
                        </div>

                        <h6 class="mt-4 mb-3">MEV Protection</h6>
                        <div class="mb-2 form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="use_jito" checked>
                            <label class="form-check-label">Use Jito Bundle Engine</label>
                        </div>
                        <div class="form-text">Jito is Solana's Flashbots equivalent - protects against sandwich attacks.</div>
                    </div>
                    <div class="col-md-6">
                        <h6 class="mb-3">Token Pairs (16 pairs)</h6>
                        <div class="token-grid">
                            <div class="token-tag">SOL/USDC</div>
                            <div class="token-tag">SOL/USDT</div>
                            <div class="token-tag">mSOL/SOL</div>
                            <div class="token-tag">stSOL/SOL</div>
                            <div class="token-tag">jitoSOL/SOL</div>
                            <div class="token-tag">bSOL/SOL</div>
                            <div class="token-tag">RAY/SOL</div>
                            <div class="token-tag">ORCA/SOL</div>
                            <div class="token-tag">JUP/SOL</div>
                            <div class="token-tag">JTO/SOL</div>
                            <div class="token-tag">BONK/SOL</div>
                            <div class="token-tag">WIF/SOL</div>
                            <div class="token-tag">PYTH/SOL</div>
                            <div class="token-tag">W/SOL</div>
                            <div class="token-tag">USDC/USDT</div>
                            <div class="token-tag">mSOL/USDC</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Triangular Arbitrage -->
            <div class="chain-card">
                <div class="chain-header">
                    <div class="chain-icon triangular"><i class="fas fa-route"></i></div>
                    <div>
                        <h5 class="mb-0">Triangular Arbitrage <span class="feature-badge badge-new">New</span></h5>
                        <small class="text-muted">A → B → C → A cycles on Ethereum</small>
                    </div>
                    <div class="form-check form-switch ms-auto">
                        <input class="form-check-input" type="checkbox" id="triangular_enabled">
                        <label class="form-check-label" for="triangular_enabled">Enabled</label>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <h6 class="mb-3">Strategy Types</h6>
                        <div class="mb-2 form-check">
                            <input class="form-check-input" type="checkbox" id="tri_stablecoin" checked>
                            <label class="form-check-label">Stablecoin Triangles (USDC/USDT/DAI)</label>
                        </div>
                        <div class="mb-2 form-check">
                            <input class="form-check-input" type="checkbox" id="tri_eth" checked>
                            <label class="form-check-label">ETH-Based Triangles</label>
                        </div>
                        <div class="mb-2 form-check">
                            <input class="form-check-input" type="checkbox" id="tri_lst" checked>
                            <label class="form-check-label">Liquid Staking (stETH/rETH/cbETH)</label>
                        </div>
                        <div class="mb-2 form-check">
                            <input class="form-check-input" type="checkbox" id="tri_defi">
                            <label class="form-check-label">DeFi Token Triangles</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6 class="mb-3">Example Cycles (20+ routes)</h6>
                        <div class="token-grid">
                            <div class="token-tag">USDC→USDT→DAI</div>
                            <div class="token-tag">WETH→USDC→WBTC</div>
                            <div class="token-tag">stETH→rETH→WETH</div>
                            <div class="token-tag">USDC→DAI→FRAX</div>
                            <div class="token-tag">WETH→LINK→USDC</div>
                            <div class="token-tag">CRV→WETH→USDC</div>
                        </div>
                        <div class="alert alert-info mt-3 mb-0">
                            <small><i class="fas fa-info-circle me-1"></i> Triangular arb finds hidden profit in 3-hop routes that don't exist in direct pairs.</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advanced Settings Tab -->
        <div class="tab-pane fade" id="settings-advanced">
            <div class="row">
                <div class="col-md-6">
                    <div class="settings-section">
                        <div class="settings-title">
                            <i class="fas fa-bolt text-warning"></i>
                            Flash Loans (Aave V3)
                        </div>

                        <div class="mb-3 form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="use_flash_loans">
                            <label class="form-check-label" for="use_flash_loans"><strong>Enable Flash Loans</strong></label>
                            <div class="form-text">Borrow capital for zero-collateral arbitrage.</div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Flash Loan Amount (ETH)</label>
                            <input type="number" class="form-control" id="flash_loan_amount" min="0.1" step="0.1" value="10">
                            <div class="form-text">Amount to borrow. Fee: 0.09% on Aave V3.</div>
                        </div>

                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>How it works:</strong> Borrow → Buy on DEX A → Sell on DEX B → Repay + Keep profit. All in one atomic transaction.
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-title">
                            <i class="fas fa-shield-alt text-success"></i>
                            MEV Protection (Flashbots)
                        </div>

                        <div class="mb-3 form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="use_flashbots">
                            <label class="form-check-label" for="use_flashbots"><strong>Enable Flashbots</strong></label>
                            <div class="form-text">Submit via private mempool to prevent front-running.</div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Priority Fee (Gwei)</label>
                            <input type="number" class="form-control" id="flashbots_priority_fee" min="1" value="3">
                            <div class="form-text">Tip for block builders. Higher = faster inclusion.</div>
                        </div>

                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Required:</strong> Set <code>FLASHBOTS_SIGNING_KEY</code> in .env for bundle signing.
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="settings-section">
                        <div class="settings-title">
                            <i class="fas fa-gas-pump text-danger"></i>
                            Gas Management
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Max Gas Price (Gwei)</label>
                            <input type="number" class="form-control" id="max_gas_price" min="10" value="100">
                            <div class="form-text">Skip opportunities when gas exceeds this limit.</div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Estimated Gas per Trade</label>
                            <input type="number" class="form-control" id="estimated_gas" min="100000" value="500000">
                            <div class="form-text">Approximate gas for flash loan + 2 swaps.</div>
                        </div>

                        <div class="mb-3 form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="use_gas_oracle" checked>
                            <label class="form-check-label">Use Etherscan Gas Oracle</label>
                            <div class="form-text">Fetch real-time gas prices for accurate threshold calculation.</div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-title">
                            <i class="fas fa-database text-primary"></i>
                            Logging & Database
                        </div>

                        <div class="mb-3 form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="log_opportunities" checked>
                            <label class="form-check-label">Log All Opportunities</label>
                            <div class="form-text">Save detected opportunities even if not executed.</div>
                        </div>

                        <div class="mb-3 form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="log_prices" checked>
                            <label class="form-check-label">Log Price Data</label>
                            <div class="form-text">Store historical price data for analysis.</div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Stats Log Interval (minutes)</label>
                            <input type="number" class="form-control" id="stats_interval" min="1" max="60" value="5">
                            <div class="form-text">How often to log aggregated statistics.</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Guide Tab -->
        <div class="tab-pane fade" id="guide">
            <div class="settings-section">
                <div class="settings-title">
                    <i class="fas fa-info-circle text-primary"></i>
                    What is the Arbitrage Module?
                </div>
                <p>The Arbitrage Module is a multi-chain, multi-strategy system that detects and executes profitable price discrepancies across decentralized exchanges. It runs three parallel engines:</p>

                <div class="row mt-4">
                    <div class="col-md-4">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5><i class="fab fa-ethereum me-2"></i>Ethereum Engine</h5>
                                <p class="text-muted">Direct arbitrage between DEXs on Ethereum</p>
                                <ul class="small">
                                    <li>Uniswap V2/V3, SushiSwap, Curve</li>
                                    <li>20+ token pairs monitored</li>
                                    <li>Flash loans via Aave V3</li>
                                    <li>Flashbots MEV protection</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5><i class="fas fa-sun me-2"></i>Solana Engine</h5>
                                <p class="text-muted">High-speed arbitrage on Solana</p>
                                <ul class="small">
                                    <li>Jupiter aggregator integration</li>
                                    <li>16+ token pairs including LSTs</li>
                                    <li>Lower fees = lower thresholds</li>
                                    <li>Jito MEV protection</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5><i class="fas fa-route me-2"></i>Triangular Engine</h5>
                                <p class="text-muted">Multi-hop cycle arbitrage</p>
                                <ul class="small">
                                    <li>A → B → C → A profit cycles</li>
                                    <li>20+ triangular routes</li>
                                    <li>Stablecoin & LST triangles</li>
                                    <li>Gas-aware execution</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <div class="settings-title">
                    <i class="fas fa-cogs text-warning"></i>
                    How It Works
                </div>

                <div class="step-card">
                    <span class="step-number">1</span>
                    <strong>Price Monitoring</strong>
                    <p class="mb-0 mt-2 text-muted">Every 2 seconds, the engines query prices from multiple DEX routers for each token pair.</p>
                </div>

                <div class="step-card">
                    <span class="step-number">2</span>
                    <strong>Spread Detection</strong>
                    <p class="mb-0 mt-2 text-muted">Calculate price difference between best buy and best sell DEX. Factor in gas costs dynamically.</p>
                </div>

                <div class="step-card">
                    <span class="step-number">3</span>
                    <strong>Profitability Check</strong>
                    <p class="mb-0 mt-2 text-muted">If spread > threshold (after gas + fees), opportunity is flagged for execution.</p>
                </div>

                <div class="step-card">
                    <span class="step-number">4</span>
                    <strong>Atomic Execution</strong>
                    <p class="mb-0 mt-2 text-muted">Execute via flash loan: Borrow → Buy low → Sell high → Repay → Keep profit. All in one tx.</p>
                </div>

                <div class="step-card">
                    <span class="step-number">5</span>
                    <strong>MEV Protection</strong>
                    <p class="mb-0 mt-2 text-muted">Submit via Flashbots (ETH) or Jito (Solana) to prevent front-running.</p>
                </div>
            </div>

            <div class="settings-section">
                <div class="settings-title">
                    <i class="fas fa-folder-tree text-info"></i>
                    Module Architecture
                </div>
                <div class="code-block">
modules/arbitrage/<br>
├── main_arbitrage.py &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Multi-chain manager entry point<br>
├── arbitrage_engine.py &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Ethereum direct arbitrage<br>
├── solana_engine.py &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Solana Jupiter/Raydium arb <span style="color: #10b981;">[NEW]</span><br>
└── triangular_engine.py &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Triangular A→B→C→A arb <span style="color: #10b981;">[NEW]</span>
                </div>
            </div>

            <div class="settings-section">
                <div class="settings-title">
                    <i class="fas fa-chart-bar text-success"></i>
                    Implementation Status
                </div>
                <table class="table table-bordered">
                    <thead class="table-light">
                        <tr><th>Feature</th><th>Status</th><th>Notes</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Ethereum Direct Arbitrage</td><td><span class="badge bg-success">Live</span></td><td>20 pairs, 3 DEXs</td></tr>
                        <tr><td>Solana Arbitrage</td><td><span class="badge bg-success">Live</span></td><td>16 pairs, Jupiter + Raydium</td></tr>
                        <tr><td>Triangular Arbitrage</td><td><span class="badge bg-success">Live</span></td><td>20+ cycles, Curve integration</td></tr>
                        <tr><td>Flash Loans (Aave V3)</td><td><span class="badge bg-success">Live</span></td><td>Zero-capital execution</td></tr>
                        <tr><td>Flashbots MEV Protection</td><td><span class="badge bg-success">Live</span></td><td>Private mempool</td></tr>
                        <tr><td>Jito MEV Protection</td><td><span class="badge bg-success">Live</span></td><td>Solana bundles</td></tr>
                        <tr><td>Dynamic Gas Thresholds</td><td><span class="badge bg-success">Live</span></td><td>Etherscan oracle</td></tr>
                        <tr><td>Multi-Chain Dashboard</td><td><span class="badge bg-success">Live</span></td><td>Per-chain stats</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Setup Tab -->
        <div class="tab-pane fade" id="setup">
            <div class="settings-section">
                <div class="settings-title">
                    <i class="fas fa-key text-danger"></i>
                    Required Environment Variables
                </div>
                <div class="code-block">
# ===== ETHEREUM CONFIGURATION =====<br>
ETHEREUM_RPC_URL=https://eth-mainnet.g.alchemy.com/v2/YOUR_KEY<br>
# or WEB3_PROVIDER_URL=...<br><br>

# ===== SOLANA CONFIGURATION ===== <span style="color: #f59e0b;">[NEW]</span><br>
SOLANA_RPC_URL=https://api.mainnet-beta.solana.com<br>
SOLANA_WALLET_ADDRESS=YOUR_SOLANA_PUBKEY<br>
SOLANA_PRIVATE_KEY=YOUR_BASE58_PRIVATE_KEY &nbsp;&nbsp;# Only for live trading<br><br>

# ===== WALLET (for live trading) =====<br>
PRIVATE_KEY=0x... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Ethereum private key<br>
WALLET_ADDRESS=0x... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Ethereum wallet address<br><br>

# ===== FLASHBOTS (MEV protection) =====<br>
FLASHBOTS_SIGNING_KEY=0x... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Separate key for bundle signing<br><br>

# ===== GAS ORACLE (optional) =====<br>
ETHERSCAN_API_KEY=YOUR_KEY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# For gas price oracle<br><br>

# ===== MODE =====<br>
DRY_RUN=true &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Set to 'false' for live trading
                </div>
            </div>

            <div class="settings-section">
                <div class="settings-title">
                    <i class="fas fa-rocket text-primary"></i>
                    Quick Start Guide
                </div>

                <div class="step-card">
                    <span class="step-number">1</span>
                    <strong>Configure RPC URLs</strong>
                    <p class="mb-0 mt-2 text-muted">Add at least <code>ETHEREUM_RPC_URL</code> to your .env file. For Solana, add <code>SOLANA_RPC_URL</code>.</p>
                </div>

                <div class="step-card">
                    <span class="step-number">2</span>
                    <strong>Set DRY_RUN=true</strong>
                    <p class="mb-0 mt-2 text-muted">Always start in simulation mode to verify the module works correctly.</p>
                </div>

                <div class="step-card">
                    <span class="step-number">3</span>
                    <strong>Monitor the Logs</strong>
                    <p class="mb-0 mt-2 text-muted">Check <code>logs/arbitrage/arbitrage.log</code> for opportunities and trades.</p>
                </div>

                <div class="step-card">
                    <span class="step-number">4</span>
                    <strong>Review Dashboard</strong>
                    <p class="mb-0 mt-2 text-muted">Use <code>/arbitrage/dashboard</code> to see stats and recent trades.</p>
                </div>

                <div class="step-card">
                    <span class="step-number">5</span>
                    <strong>Enable Engines Selectively</strong>
                    <p class="mb-0 mt-2 text-muted">Start with Ethereum only, then add Solana and Triangular once comfortable.</p>
                </div>

                <div class="step-card">
                    <span class="step-number">6</span>
                    <strong>Configure MEV Protection</strong>
                    <p class="mb-0 mt-2 text-muted">Before going live, set up Flashbots (ETH) or Jito (Solana) to prevent front-running.</p>
                </div>

                <div class="step-card">
                    <span class="step-number">7</span>
                    <strong>Go Live (Carefully)</strong>
                    <p class="mb-0 mt-2 text-muted">Set <code>DRY_RUN=false</code>, add wallet keys, start with small amounts.</p>
                </div>
            </div>

            <div class="settings-section">
                <div class="settings-title">
                    <i class="fas fa-exclamation-triangle text-danger"></i>
                    Risk Warning
                </div>
                <div class="alert alert-danger">
                    <ul class="mb-0">
                        <li><strong>MEV Competition:</strong> Professional bots compete for the same opportunities. Without MEV protection, you may be front-run.</li>
                        <li><strong>Smart Contract Risk:</strong> Flash loan contracts can have vulnerabilities.</li>
                        <li><strong>Gas Wars:</strong> In competitive markets, gas costs can exceed profits.</li>
                        <li><strong>Slippage:</strong> Large trades move prices, reducing actual profit.</li>
                        <li><strong>Capital at Risk:</strong> Live trading can result in losses. Only trade what you can afford to lose.</li>
                    </ul>
                </div>
            </div>

            <div class="settings-section">
                <div class="settings-title">
                    <i class="fas fa-lightbulb text-warning"></i>
                    Best Practices
                </div>
                <ul>
                    <li><strong>Start Small:</strong> Begin with 0.1-1 ETH/SOL trade sizes until you understand the system.</li>
                    <li><strong>Monitor Gas:</strong> High gas = lower profits. Consider pausing during gas spikes.</li>
                    <li><strong>Diversify:</strong> Enable multiple engines (ETH + Solana + Triangular) for more opportunities.</li>
                    <li><strong>Use Private RPC:</strong> Public RPCs have rate limits. Use Alchemy, Infura, or QuickNode.</li>
                    <li><strong>Check Logs Daily:</strong> Review trades and opportunities to optimize thresholds.</li>
                    <li><strong>Enable MEV Protection:</strong> Always use Flashbots/Jito for live trading.</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', loadSettings);

    async function loadSettings() {
        try {
            const response = await fetch('/api/arbitrage/settings');
            const data = await response.json();

            if (data.success && data.settings) {
                const s = data.settings;

                // General
                document.getElementById('enabled').checked = s.enabled === true;
                document.getElementById('dry_run').checked = s.dry_run !== false;
                document.getElementById('min_profit_spread').value = s.min_profit_spread || 0.5;
                document.getElementById('gas_aware_threshold').checked = s.gas_aware_threshold !== false;
                document.getElementById('gas_buffer').value = s.gas_buffer || 1.5;
                document.getElementById('eth_trade_amount').value = s.eth_trade_amount || 1;
                document.getElementById('sol_trade_amount').value = s.sol_trade_amount || 1;
                document.getElementById('max_daily_trades').value = s.max_daily_trades || 5;
                document.getElementById('scan_interval').value = s.scan_interval || 2;
                document.getElementById('opportunity_cooldown').value = s.opportunity_cooldown || 30;

                // Chains
                document.getElementById('ethereum_enabled').checked = s.ethereum_enabled !== false;
                document.getElementById('solana_enabled').checked = s.solana_enabled === true;
                document.getElementById('triangular_enabled').checked = s.triangular_enabled === true;

                // DEXs
                document.getElementById('dex_uniswap_v2').checked = s.dex_uniswap_v2 !== false;
                document.getElementById('dex_sushiswap').checked = s.dex_sushiswap !== false;
                document.getElementById('dex_uniswap_v3').checked = s.dex_uniswap_v3 !== false;
                document.getElementById('dex_curve').checked = s.dex_curve === true;
                document.getElementById('dex_balancer').checked = s.dex_balancer === true;
                document.getElementById('dex_jupiter').checked = s.dex_jupiter !== false;
                document.getElementById('dex_raydium').checked = s.dex_raydium !== false;
                document.getElementById('use_jito').checked = s.use_jito !== false;

                // Advanced
                document.getElementById('use_flash_loans').checked = s.use_flash_loans === true;
                document.getElementById('flash_loan_amount').value = s.flash_loan_amount || 10;
                document.getElementById('use_flashbots').checked = s.use_flashbots === true;
                document.getElementById('flashbots_priority_fee').value = s.flashbots_priority_fee || 3;
                document.getElementById('max_gas_price').value = s.max_gas_price || 100;
                document.getElementById('estimated_gas').value = s.estimated_gas || 500000;
                document.getElementById('use_gas_oracle').checked = s.use_gas_oracle !== false;
            }
        } catch (error) {
            console.error('Error loading settings:', error);
        }
    }

    async function saveSettings() {
        const settings = {
            // General
            enabled: document.getElementById('enabled').checked,
            dry_run: document.getElementById('dry_run').checked,
            min_profit_spread: parseFloat(document.getElementById('min_profit_spread').value),
            gas_aware_threshold: document.getElementById('gas_aware_threshold').checked,
            gas_buffer: parseFloat(document.getElementById('gas_buffer').value),
            eth_trade_amount: parseFloat(document.getElementById('eth_trade_amount').value),
            sol_trade_amount: parseFloat(document.getElementById('sol_trade_amount').value),
            max_daily_trades: parseInt(document.getElementById('max_daily_trades').value),
            scan_interval: parseInt(document.getElementById('scan_interval').value),
            opportunity_cooldown: parseInt(document.getElementById('opportunity_cooldown').value),

            // Chains
            ethereum_enabled: document.getElementById('ethereum_enabled').checked,
            solana_enabled: document.getElementById('solana_enabled').checked,
            triangular_enabled: document.getElementById('triangular_enabled').checked,

            // DEXs
            dex_uniswap_v2: document.getElementById('dex_uniswap_v2').checked,
            dex_sushiswap: document.getElementById('dex_sushiswap').checked,
            dex_uniswap_v3: document.getElementById('dex_uniswap_v3').checked,
            dex_curve: document.getElementById('dex_curve').checked,
            dex_balancer: document.getElementById('dex_balancer').checked,
            dex_jupiter: document.getElementById('dex_jupiter').checked,
            dex_raydium: document.getElementById('dex_raydium').checked,
            use_jito: document.getElementById('use_jito').checked,

            // Triangular
            tri_stablecoin: document.getElementById('tri_stablecoin').checked,
            tri_eth: document.getElementById('tri_eth').checked,
            tri_lst: document.getElementById('tri_lst').checked,
            tri_defi: document.getElementById('tri_defi').checked,

            // Advanced
            use_flash_loans: document.getElementById('use_flash_loans').checked,
            flash_loan_amount: parseFloat(document.getElementById('flash_loan_amount').value),
            use_flashbots: document.getElementById('use_flashbots').checked,
            flashbots_priority_fee: parseInt(document.getElementById('flashbots_priority_fee').value),
            max_gas_price: parseInt(document.getElementById('max_gas_price').value),
            estimated_gas: parseInt(document.getElementById('estimated_gas').value),
            use_gas_oracle: document.getElementById('use_gas_oracle').checked,
            log_opportunities: document.getElementById('log_opportunities').checked,
            log_prices: document.getElementById('log_prices').checked,
            stats_interval: parseInt(document.getElementById('stats_interval').value)
        };

        try {
            const response = await fetch('/api/arbitrage/settings', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(settings)
            });
            const data = await response.json();

            if (data.success) {
                alert('Settings saved successfully!');
            } else {
                alert('Error: ' + (data.error || 'Unknown error'));
            }
        } catch (error) {
            alert('Error saving settings: ' + error.message);
        }
    }
</script>
{% endblock %}
