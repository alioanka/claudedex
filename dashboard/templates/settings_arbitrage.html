{% extends "base.html" %}

{% block title %}Arbitrage Settings - ClaudeDex{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Arbitrage Module Configuration</h5>
                    <button class="btn btn-primary" onclick="saveSettings()">
                        <i class="fas fa-save me-2"></i>Save Changes
                    </button>
                </div>
                <div class="card-body">
                    <form id="arbitrageSettingsForm">
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-uppercase text-muted mb-3">Execution Parameters</h6>

                                <div class="mb-3 form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="enabled">
                                    <label class="form-check-label" for="enabled">Enable Arbitrage</label>
                                    <div class="form-text">Master switch for the arbitrage module.</div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Min Profit Spread (%)</label>
                                    <input type="number" class="form-control" id="min_profit_spread" min="0.1" step="0.1" value="0.5">
                                    <div class="form-text">Minimum profit margin required to execute an arb.</div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Max Trade Amount (USD)</label>
                                    <input type="number" class="form-control" id="max_trade_amount" step="100" value="1000">
                                </div>
                            </div>

                            <div class="col-md-6">
                                <h6 class="text-uppercase text-muted mb-3">DEX Selection</h6>

                                <div class="mb-3">
                                    <label class="form-label">Primary DEX</label>
                                    <select class="form-select" id="primary_dex">
                                        <option value="uniswap_v3">Uniswap V3</option>
                                        <option value="sushiswap">SushiSwap</option>
                                        <option value="pancakeswap">PancakeSwap</option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Secondary DEXs</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="dex_uniswap" checked>
                                        <label class="form-check-label">Uniswap V3</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="dex_sushi" checked>
                                        <label class="form-check-label">SushiSwap</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="dex_curve">
                                        <label class="form-check-label">Curve</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Guide -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-book me-2"></i>Arbitrage Guide</h5>
                </div>
                <div class="card-body">
                    <h6>Overview</h6>
                    <p>The Arbitrage Module scans for price discrepancies between different Decentralized Exchanges (DEXs) for the same token pair. It executes atomic transactions to profit from these differences without exposure to market risk.</p>

                    <h6>Configuration Tips</h6>
                    <ul>
                        <li><strong>Min Profit Spread:</strong> Start with at least 0.5% to cover gas fees and slippage.</li>
                        <li><strong>DEX Selection:</strong> Enable DEXs with high liquidity to minimize slippage. Uniswap V3 is recommended as a primary source.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', loadSettings);

    async function loadSettings() {
        try {
            const response = await fetch('/api/arbitrage/settings');
            const data = await response.json();

            if (data.success) {
                const settings = data.settings;
                document.getElementById('enabled').checked = settings.enabled === true;
                document.getElementById('min_profit_spread').value = settings.min_profit_spread || 0.5;
                document.getElementById('max_trade_amount').value = settings.max_trade_amount || 1000;
                document.getElementById('primary_dex').value = settings.primary_dex || 'uniswap_v3';
            }
        } catch (error) {
            console.error('Error loading settings:', error);
        }
    }

    async function saveSettings() {
        const settings = {
            enabled: document.getElementById('enabled').checked,
            min_profit_spread: parseFloat(document.getElementById('min_profit_spread').value),
            max_trade_amount: parseFloat(document.getElementById('max_trade_amount').value),
            primary_dex: document.getElementById('primary_dex').value
        };

        try {
            const response = await fetch('/api/arbitrage/settings', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(settings)
            });
            const data = await response.json();
            if(data.success) alert('Settings saved!');
            else alert('Error: ' + data.error);
        } catch (error) {
            alert('Error saving settings');
        }
    }
</script>
{% endblock %}
