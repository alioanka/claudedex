{% extends "base.html" %}

{% block title %}Score Inspector - Trading Bot{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1>Opportunity Score Inspector</h1>
    <p>Enter a token address to see a detailed breakdown of its opportunity score.</p>

    <div class="card">
        <div class="card-body">
            <div class="form-group">
                <label for="token-address">Token Address</label>
                <input type="text" class="form-control" id="token-address" placeholder="Enter token address">
            </div>
            <div class="form-group">
                <label for="chain-select">Chain</label>
                <select class="form-control" id="chain-select">
                    <option value="ethereum">Ethereum</option>
                    <option value="bsc">BSC</option>
                    <option value="base">Base</option>
                    <option value="solana">Solana</option>
                    <option value="arbitrum">Arbitrum</option>
                    <option value="polygon">Polygon</option>
                </select>
            </div>
            <button class="btn btn-primary" onclick="inspectScore()">Inspect Score</button>
        </div>
    </div>

    <div id="score-results" class="mt-4" style="display: none;">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Score Breakdown</h5>
                <div id="score-details"></div>
            </div>
        </div>
    </div>
</div>

<script>
    async function inspectScore() {
        const tokenAddress = document.getElementById('token-address').value;
        const chain = document.getElementById('chain-select').value;

        const response = await fetch(`/api/score_inspector?token_address=${tokenAddress}&chain=${chain}`);
        const result = await response.json();

        const resultsDiv = document.getElementById('score-results');
        const detailsDiv = document.getElementById('score-details');

        if (result.success) {
            let html = `
                <h4>Overall Score: ${result.data.final_score.toFixed(4)}</h4>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Component</th>
                            <th>Score</th>
                            <th>Weight</th>
                            <th>Contribution</th>
                            <th>Raw Value</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            for (const component in result.data.score_breakdown) {
                const data = result.data.score_breakdown[component];
                html += `
                    <tr>
                        <td>${component}</td>
                        <td>${data.score.toFixed(4)}</td>
                        <td>${(data.weight * 100).toFixed(0)}%</td>
                        <td>${data.contribution.toFixed(4)}</td>
                        <td>${data.raw_value}</td>
                    </tr>
                `;
            }
            html += `</tbody></table>`;
            detailsDiv.innerHTML = html;
            resultsDiv.style.display = 'block';
        } else {
            detailsDiv.innerHTML = `<div class="alert alert-danger">${result.error}</div>`;
            resultsDiv.style.display = 'block';
        }
    }
</script>
{% endblock %}
